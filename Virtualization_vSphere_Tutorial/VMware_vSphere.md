# VMware vSphere

vSphere : ESXi Server, vCenter 그리고 여러 기능들이 포함된 패키지

## SDDC(Software Defined DataCenter)

데이터센터의 모든 인프라가 가상화되고 서비스로 제공되며, 데이터센터 전체를 소프트웨어로 구성하여 자동으로 제어·관리할 수 있는 데이터센터   

단순히 각 벤더의 하드웨어 위에 가상화가 별도로 이루어지는 것이 아닌 데이터센터 전체(서버, 스토리지, 네트워크)를 가상화하겠다는 의미.

> <h3>SDDC의 개별 요소</h3>

![image](https://user-images.githubusercontent.com/43658658/143796942-87b29728-b93f-48ce-82a9-303f23cfc180.png)

#### 컴퓨팅 요소

vSphere와 같은 컴퓨팅 가상화입니다. CPU, 메모리, 디스크 등 서버 자원이 컴퓨팅 가상화의 대상입니다.

#### 네트워크 요소

네트워크 서비스 및 장비에 대한 자동화 부분입니다. 기존에 하드웨어 장비로 존재하던 스위치, 라우터, 방화벽 등이 가상화로 완전히 전환됩니다.

#### 스토리지 요소

가상으로 구축 가능한 스토리지 구성요소입니다. 더이상 기존에 구축하던 외장형의 스토리지 장비가 필요 없어지고 서버의 로컬 내장 디스크로 구현됩니다.   
기존 하드웨어 중심의 스토리지 관리에서 VM 중심의 스토리지 관리로 이동하는 것입니다.

#### 매니지먼트 요소

서버, 네트워크, 스토리지의 각 구성 요소가 가상화되고 이를 Private Cloud 형태로 구축하고 클라우드 관리에 대한 솔루션 및 프레임워크를 제공하는 부분입니다.

## CPU 가상화 동작의 개요

ESXi에서는 물리적인 CPU를 가상화하여 가상머신에 할당할 수 있습니다.

> <h3>특징</h3>

물리 서버에 존재하는 복수의 논리 CPU의 부하를 동적으로 로드밸런싱합니다.
* CPU의 단위 : 소켓 -> 코어 -> 쓰레드
* 코어의 자원을 ESXi 서버가 실시간으로 여러 대의 가상머신에 동적으로 분배합니다.

동적으로 물리/논리 CPU에 대한 모니터링을 실시하면서 동적으로 특정 CPU에 부하가 집중되는 것을 방지합니다.
* 수십 밀리 세컨드 단위로 전체 CPU를 체크하면서 여유가 있는 CPU 자원을 확인한 다음 전체 가상머신에 골고루 할당합니다.

## 메모리 가상화 기술 개요

1. 투명한 페이지 공유 기술 : 효율적 메모리 관리
2. 메모리 벌루닝 기술 : 효율적 메모리 관리
3. 메모리 압축 기술 : 시스템 보호
4. VMKernel 스왑 기술 : 시스템 보호

> <h3>투명한 페이지 공유</h3>

![image](https://user-images.githubusercontent.com/43658658/143798470-e947039c-3bab-439b-8fa0-e4119798bb39.png)

가상머신 사이에서 동일한 정적 메모리 페이지를 공유하는 기능입니다.   
여러 대의 가상머신이 하나의 물리적인 서버 위에서 운용될 때 동일한 종류의 가상머신일 경우 같은 페이지를 사용하기도 합니다.   
이런 동일한 가상 페이지를 물리적인 하드웨어의 같은 페이지를 참조하도록 설정합니다.

> <h3>메모리 벌루닝</h3>

동작을 멈추고 있는 상태의 가상머신이 보유하고 있는 메모리 영역을 회수하여, 다른 가상머신에게 할당해주는 기능입니다.   
다른 가상머신에서 메모리가 모자라 하이퍼바이저에 요구할 때 발생합니다.

![image](https://user-images.githubusercontent.com/43658658/143798802-90673aef-b8aa-4a93-9b79-0cc92781c16c.png)
가상머신은 실제 메모리를 자신이 모두 사용한다고 생각합니다.   
VMtools 중 Driver를 이용해서 오버헤드를 일으켜 스왑파일로 오버헤드된 메모리 페이지를 `실제 메모리`에 저장(Swap Out)하고, 
확보된 메모리 페이지를 스왑파일에서 메모리가 필요한 가상머신으로 할당해줍니다.

> <h3>메모리 압축</h3>

메모리에 동일한 데이터가 있다면 동일한 데이터를 메모리 안에서 압축하는 기능입니다.   
가상머신에 메모리 요구가 발생하고 메모리를 회수할 수 없는 상황이 되었을 경우 발생합니다.

메모리 데이터를 압축하여 VMKernel 스왑을 줄이고 퍼포먼스 저하를 방지하는 기능입니다.

> <h3>VMKernel 스왑</h3>

물리 메모리가 부족한 경우, VMKernel은 가상머신의 메모리를 `디스크`의 스왑파일에 스왑 아웃합니다.   
모든 가상머신이 Busy해서 메모리가 부족할 때 발생하는 현상입니다.   
앞선 3가지 기술이 모두 적용될 수 없을 때 마지막에 사용하는 기술입니다.   

메모리 벌루닝과의 차이점은 메모리 벌루닝은 메모리에 스왑 아웃하지만, VMKernel 스왑은 `디스크`에 스왑 아웃한다는 것입니다.   
메모리에서 디스크로 스왑 아웃을 하기 때문에 전체적인 성능에 영향을 미칩니다.

## 스토리지 가상화 기술

> <h3>RAID 기술</h3>

