# Ch 1. 네트워크 시작하기

## 프로토콜

네트워크에서 통신할 때의 규약입니다.   

자연어로 불리는 일반 언어와 유사하게 사용되면 이해하기 쉬울 텐데 한정된 자원으로 통신을 수행해야 하다 보니 최대한 적은 데이터를 이용해 효율적인 프로토콜을 정의하고 사용해야 했습니다.   
그래서 적은 컴퓨팅 자원과 느린 네트워크에서도 최대한 효율적으로 통신하기 위해 대부분의 프로토콜은 문자 기반이 아닌 `2진수 비트`를 기반으로 만들어졌습니다.   
애플리케이션 레벨의 프로토콜은 비트 기반이 아닌 `문자 기반` 프로토콜을 많이 사용하고 있습니다.   

## OSI 7계층

`복잡한 데이터 전송 과정`을 7계층으로 나눈 것입니다.   
과거에는 통신용 규약이 표준화 되지 않아서, 각 벤더에서 별도로 개발했습니다.    
따라서 호환되지 않는 시스템이나 애플리케이션이 많았는데, 이를 하나의 규약으로 통합하여 만든 것이 `OSI 7계층`입니다.

![image](https://user-images.githubusercontent.com/43658658/142789589-f1caeaa9-eaee-49ad-b31e-9fa096a24326.png)   
OSI 7계층은 네트워크 동작을 나누어 이해하고 개발하는데 많은 도움이 되므로 네트워크의 주요 래퍼런스 모델로 활용되고 있습니다.

* 5~7계층 : 애플리케이션 계층(Application Layer) / 상위 계층(Upper Layer)
  - 데이터를 만들고 표현하는데 초점.
  - 애플리케이션 개발자들이 고려해야 할 영역이라 네트워크 엔지니어는 일반적으로 심각하게 고려하지 않습니다.
* 1~4계층 : 데이터 플로 계층(Data Flow Layer) / 하위 계층(Lower Layer)
  - 데이터를 상대방에게 잘 전달하는 역할 

> <h3>1계층(피지컬 계층)</h3>

들어온 전기 신호를 그대로 잘 전달하는 것이 목적입니다.   
1계층의 주요 장비로는 허브, 리피터, 케이블, 커넥터, 트랜시버, 탭이 있습니다.   
* 허브, 리피터 : 네트워크 통신을 중계하는 네트워크 장비
* 트랜시버 : 컴퓨터의 랜 카드와 케이블을 연결하는 장치
* 탭 : 네트워크 모니터링과 패킷 분석을 위해 전기 신호를 다른 장비로 복제하는 역할

![image](https://user-images.githubusercontent.com/43658658/142791121-1da6edeb-9d0b-492a-a648-ae7329aab6fe.png)   
전기 신호가 1계층 장비에 들어오면 전기 신호를 재생성하여 내보냅니다.   
주소의 개념이 없어 들어온 포트를 제외하고 모든 포트에 같은 전기 신호를 전송합니다.

> <h3>2계층(데이터 링크 계층)</h3>

전기 신호를 모아 우리가 알아볼 수 있는 `데이터 형태로 처리`합니다.   
전기 신호를 정확히 전달하기보다는 `주소 정보를 정의`하고 `정확한 주소로 통신`이 되도록 하는데 초점이 맞춰져 있습니다.

전기 신호를 모아 데이터 형태로 처리하므로 데이터에 대한 에러를 탐지하는 역할을 수행할 수 있습니다.   

2계층에서 동작하는 네트워크 구성 요소는 네트워크 인터페이스 카드(랜카드)와 스위치입니다.

![image](https://user-images.githubusercontent.com/43658658/142791759-320ecd19-7a6b-4762-8b66-0824f46cd832.png)   
1. 전기 신호를 데이터 형태로 만듭니다.
2. 목적지 MAC 주소와 출발지 MAC 주소를 확인합니다.
3. 랜 카드의 MAC 주소를 확인합니다.
4. 목직지 MAC 주소와 랜 카드의 MAC 주소가 같다면 상위 계층에서 처리할 수 있도록 `메모리에 적재`하고 다르면 `데이터를 폐기`합니다.

> <h3>3계층(네트워크 계층)</h3>

데이터 통신을 할 때는 두 가지 주소가 사용되는데, 2계층의 물리적인 MAC 주소와, 3계층의 논리적인 IP 주소입니다.   
MAC 주소와 달리 IP 주소는 사용자가 환경에 맞게 변경해 사용할 수 있고 네트워크 주소 부분과 호스트 주소 부분으로 나뉩니다.   
![image](https://user-images.githubusercontent.com/43658658/142792678-5b70564e-ab25-4e4e-93ba-70fa059ddb80.png)   

3계층에서 동작하는 장비는 `라우터`입니다.   
라우터는 IP 주소를 사용해 최적의 경로를 찾아주고, 해당 경로로 패킷을 전송하는 역할을 합니다.   
네트워크 주소 정보를 이용해 자신이 속한 네트워크 원격지 네트워크를 구분하고 원격지 네트워크로 가려면 어디로 가야 하는지 경로를 지정하는 능력이 있습니다.   
![image](https://user-images.githubusercontent.com/43658658/142793121-a903ed65-6b9e-4380-bcb8-3b864ad5aae4.png)   

> <h3>4계층(트랜스포트 계층)</h3>

실제로 해당 데이터들이 정상적으로 잘 보내지도록 확인하는 역할을 합니다.   
중간에 패킷이 유실되거나 순서가 바뀌는 경우가 생길 수 있는데, 이것을 바로잡아 주는 역할을 합니다.

패킷을 분할할 때 패킷 헤더에 `보내는 순서(시퀀스 번호)`와 `받는 순서(ACK 번호)`를 적어 통신하므로, 패킷이 유실되면 재전송을 요청할 수 있고, 순서가 바뀌더라도 바로잡을 수 있습니다.   
장치 내에 많은 애플리케이션을 구분할 수 있도록 `포트 번호`를 사용합니다.

4계층에서 동작하는 장비로는 `로드밸런서`와 `방화벽`이 있습니다.
* 로드밸런서 : 포트 번호, 시퀀스 번호, ACK 번호 정보를 이용해 부하를 분산
* 방화벽 : 보안 정책을 수립해 패킷을 통과, 차단하는 기능 수행

> <h3>5계층(세션 계층)</h3>

양 끝단의 응용 프로세스가 연결을 성립하도록 도와주고 연결이 안정적으로 유지되도록 관리하고 작업 완료 후에는 이 연결을 끊는 역할을 합니다.
에러로 중단된 통신에 대한 에러 복구와 재전송도 수행합니다.

> <h3>6계층(프레젠테이션 계층)</h3>

표현 방식이 다른 애플리케이션이나 시스템 간의 통신을 돕기 위해 하나의 통일된 구문 형식으로 변환시키는 기능을 수행합니다.   
인코딩, 암호화, 압축, 코드 변환과 같은 동작이 이루어집니다.

> <h3>7계층(애플리케이션 계층)</h3>

애플리케이션 프로세스를 정의하고 애플리케이션 서비스를 수행합니다.   
UI 부분이나 사용자 입.출력 부분을 정의하는 역할을 합니다.   
대표적인 프로토콜로는 FTP, SMTP, HTTP, TELNET이 있습니다.

## 인캡슐레이션과 디캡슐레이션

상위 계층에서 하위 계층으로 데이터를 보내면(인캡슐레이션) 물리 계층에서 전기 신호 형태로 네트워크를 통해 신호를 보냅니다.   
받는 쪽에서는 다시 하위 계층에서 상위 계층으로 데이터를 보냅니다(디캡슐레이션).

![image](https://user-images.githubusercontent.com/43658658/142794946-8586e9b9-5a26-49d5-8922-a8d366d47bd8.png)

헤더 정보는 복잡한데 두 가지 정보는 반드시 포함됩니다.   
1. 현재 계층에서 정의하는 정보 : 각 계층에 해당하는 `헤더 정보`
2. 상위 프로토콜 지시자 : `어떤 상위 프로토콜`로 보내주어야 할지에 대한 정보

> <h3>인캡슐레이션</h3>

* 인캡슐레이션 : 애플리케이션에서 데이터를 데이터 플로 계층으로 내려보내면서 패킷에 데이터를 넣을 수 있도록 분할

네트워크 상황을 고려해 적절한 크기로 데이터를 쪼개고 4계층부터 2계층까지 네트워크 전송을 위한 정보를 헤더에 붙여넣습니다(3개의 헤더 정보 생성).   
* 4계층 헤더 정보 : 시퀀스 번호, ACK 번호, 포트 번호
* 3계층 헤더 정보 : 출발지·도착지 IP 주소
* 2계층 헤더 정보 : 출발지·도착지 MAC 주소

이때 헤더 정보는 문자가 아닌 미리 정의된 2진수 비트 단위로 씁니다.

2계층에서 패킷은 전기 신호로 변환되어 1계층을 거쳐 수신자에게 전송됩니다.

> <h3>디캡슐레이션</h3>

* 디캡슐레이션 : 데이터 플로 계층에서 데이터를 애플리케이션 계층으로 올려보내면서 패킷을 데이터 형태로 조합

1계층을 거쳐 2계층에서, 받은 전기 신호를 데이터 형태로 만들어 랜 카드로 전달합니다. 목적지의 MAC 주소가 랜 카드의 MAC 주소와 맞지 않다면 패킷을 버립니다.   
목적지가 맞다면 3계층으로 정보를 보내줍니다. 이때 2계층의 헤더 정보는 필요 없으므로 벗겨내고 올려보냅니다.   
데이터를 받은 3계층에서는 2계층이 동작했던 것처럼 3계층의 헤더 정보를 확인해 자신에게 온 것이 맞다면 3계층 헤더 정보를 제거하고 4계층으로 올려보냅니다.   
4계층에서는 헤더 정보를 통해 패킷의 유실 유무, 순서를 체크합니다.

## TCP/IP 프로토콜 스택

별도 계층에서 동작하는 프로토콜이지만 함께 사용하는 프로토콜 묶음을 `프로토콜 스택`이라고 부릅니다.   

![image](https://user-images.githubusercontent.com/43658658/142789313-1eb58cd9-9871-4ff2-9a8c-c8d9ccca2a6e.png)   
위 사진은 TCP/IP 프로토콜 스택을 나타냅니다. 많은 프로토콜이 있지만 `TCP/IP 프로토콜 스택`이라고 하는 이유는 현대 네트워크는 대부분 TCP/IP와 이더넷으로 이루어져 있기 때문입니다.   
다양한 기술과 프로토콜 중 어느 것을 선택해야 할지 고민하던 과거와는 달리, 현대에는 TCP/IP, 이더넷을 선택하면 대부분의 네트워크를 구성할 수 있습니다.

![image](https://user-images.githubusercontent.com/43658658/142790001-7d6b591b-f78d-43da-8139-dee3d8954b6c.png)   
TCP/IP 모델에서는 개발자와 엔지니어가 고려해야 할 부분이 더 명확하게 구분되어 있습니다.
상위 3개 계층을 하나의 애플리케이션 계층으로 묶고, 1, 2계층은 하나의 네트워크 계층으로 구분합니다.

## MSS & MTU

![image](https://user-images.githubusercontent.com/43658658/142803262-25713732-7078-48c2-87d5-da4870d5129e.png)   
`MSS(Maximum Segment Size)` : 패킷을 분리할 때 네트워크에서 수용할 수 있는 크기를 역산정해 데이터가 4계층으로 내려올 때 적절한 크기로 쪼개질 수 있도록 유도하는 값(4계층 데이터값). 4계층 헤더까지를 제외한 데이터 크기   
`MTU(Maximum Transmission Unit)` : 네트워크에서 한 번에 보낼 수 있는 데이터 크기(2계층 데이터값). 2계층 헤더를 제외한 데이터 크기.   


